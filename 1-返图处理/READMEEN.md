# 钢网毛刺图片筛选工具 v2.0

这个工具可以扫描指定路径下的所有文件夹，找到包含"钢网毛刺"标签的图片和JSON文件，并将它们复制到目标文件夹的result子文件夹中。

## 版本特点

- **无需命令行参数**：直接在代码中配置路径
- **简单易用**：修改配置后直接运行即可
- **支持试运行**：可以先预览将要复制的文件
- **递归扫描**：自动遍历所有子文件夹
- **中文标签支持**：完美支持中文标签识别

## 快速开始

### 1. 修改配置

打开 `find_steel_burr_images_v2.py` 文件，找到配置区域：

```python
# ==================== 配置区域 ====================
# 在这里修改你的路径配置

# 源路径：包含多个文件夹的根目录
SOURCE_PATH = r"D:\数据集"  # 修改为你的源路径

# 目标路径：结果将保存到该路径下的result文件夹
TARGET_PATH = r"D:\结果"    # 修改为你的目标路径

# 要筛选的标签名称
TARGET_LABEL = "钢网毛刺"   # 可以修改为其他标签

# 是否启用试运行模式（True=只预览不复制，False=实际复制）
DRY_RUN = False
# ==================== 配置区域结束 ====================
```

### 2. 运行脚本

```bash
python find_steel_burr_images_v2.py
```

## 配置说明

### 必需配置

- **SOURCE_PATH**: 源数据路径，包含多个子文件夹的根目录
- **TARGET_PATH**: 目标路径，结果将保存到该路径下的result子文件夹

### 可选配置

- **TARGET_LABEL**: 要筛选的标签名称，默认为"钢网毛刺"
- **DRY_RUN**: 试运行模式开关
  - `True`: 只预览将要复制的文件，不实际复制
  - `False`: 实际复制文件

## 使用示例

### 示例1：筛选钢网毛刺标签

```python
SOURCE_PATH = r"D:\我的数据集"
TARGET_PATH = r"D:\筛选结果"
TARGET_LABEL = "钢网毛刺"
DRY_RUN = False
```

### 示例2：筛选其他标签

```python
SOURCE_PATH = r"D:\缺陷数据集"
TARGET_PATH = r"D:\划痕结果"
TARGET_LABEL = "划痕"
DRY_RUN = True  # 先试运行预览
```

### 示例3：试运行模式

```python
SOURCE_PATH = r"D:\测试数据"
TARGET_PATH = r"D:\测试结果"
TARGET_LABEL = "污渍"
DRY_RUN = True  # 试运行，不实际复制
```

## 工作流程

1. **配置阶段**: 在代码中设置源路径、目标路径和标签名称
2. **扫描阶段**: 递归遍历源路径下的所有文件夹
3. **解析阶段**: 读取每个JSON文件，检查shapes下的label字段
4. **匹配阶段**: 找到包含目标标签的JSON文件，并验证对应的图片文件
5. **复制阶段**: 将匹配的文件对复制到目标路径的result子文件夹中

## 文件结构要求

### 源文件夹结构
```
源路径/
├── 文件夹1/
│   ├── image1.png
│   ├── image1.json
│   ├── image2.png
│   └── image2.json
├── 文件夹2/
│   ├── image3.png
│   └── image3.json
└── ...
```

### JSON文件格式
JSON文件应该包含以下结构：
```json
{
  "imagePath": "image1.png",
  "shapes": [
    {
      "label": "钢网毛刺",
      "points": [...],
      "shape_type": "polygon"
    }
  ]
}
```

### 输出结构
```
目标路径/
└── result/
    ├── image1.png
    ├── image1.json
    ├── image2.png
    └── image2.json
```

## 使用建议

### 首次使用

1. **先试运行**: 设置 `DRY_RUN = True`，预览将要复制的文件
2. **确认路径**: 检查源路径和目标路径是否正确
3. **实际复制**: 确认无误后，设置 `DRY_RUN = False` 执行实际复制

### 路径设置

- 使用原始字符串（r前缀）避免路径转义问题
- 确保路径使用正确的分隔符（Windows用`\`，Linux/Mac用`/`）
- 检查路径是否存在，脚本会自动创建目标路径

### 标签筛选

- 支持部分匹配，如标签"钢网毛刺"会匹配"钢网毛刺缺陷"
- 可以修改为任何中文或英文标签
- 标签匹配不区分大小写

## 注意事项

1. **文件编码**: JSON文件应该使用UTF-8编码，以正确支持中文标签
2. **文件匹配**: 脚本通过JSON文件中的`imagePath`字段来匹配对应的图片文件
3. **递归深度**: 脚本会递归扫描所有子文件夹，但会跳过隐藏文件夹和名为`result`的文件夹
4. **错误处理**: 如果某个JSON文件无法解析或对应的图片文件不存在，脚本会显示警告信息但继续处理其他文件

## 错误排查

### 常见问题

1. **路径不存在**: 检查 `SOURCE_PATH` 和 `TARGET_PATH` 是否正确
2. **权限错误**: 确保有读取源文件夹和写入目标文件夹的权限
3. **编码错误**: 如果JSON文件包含中文，确保文件使用UTF-8编码
4. **图片文件缺失**: 检查JSON文件中的`imagePath`字段是否正确

### 调试建议

- 使用试运行模式先预览操作结果
- 检查控制台输出的警告信息
- 确认JSON文件格式正确
- 验证图片文件路径是否有效

## 扩展功能

### 筛选其他标签

只需要修改 `TARGET_LABEL` 即可筛选其他类型的标签：

```python
# 筛选划痕
TARGET_LABEL = "划痕"

# 筛选污渍
TARGET_LABEL = "污渍"

# 筛选任何包含"缺陷"的标签
TARGET_LABEL = "缺陷"
```

### 批量处理不同标签

可以复制脚本文件，为不同标签创建不同的配置文件：

```bash
# 钢网毛刺筛选
python find_steel_burr_images_v2.py

# 划痕筛选（修改后的脚本）
python find_scratch_images.py

# 污渍筛选（修改后的脚本）
python find_stain_images.py
```

## 版本历史

- **v2.0**: 移除命令行参数，改为代码配置方式，使用更简单
- **v1.0**: 支持命令行参数的原始版本 