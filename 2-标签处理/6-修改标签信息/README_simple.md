# JSON标签修改工具 - 简化版

这是一个简化的JSON标签修改工具，可以在指定根路径下深度搜索指定的文件夹名称（如A1、B1、C1等），并修改其中JSON文件的标签。

## 功能特点

- **简单易用**: 路径和标签直接在代码中配置，无需命令行参数
- **深度搜索**: 在根路径下递归搜索指定的文件夹名称（如A1、B1、C1等）
- **批量处理**: 支持批量修改JSON文件中的标签
- **安全确认**: 运行前会显示配置信息并询问确认
- **详细统计**: 提供完整的处理统计信息
- **错误处理**: 完善的错误处理机制

## 文件说明

- `change_labels_simple.py` - 主要的标签修改脚本
- `README_simple.md` - 本说明文档

## 快速开始

### 1. 修改配置

打开 `change_labels_simple.py` 文件，找到配置区域：

```python
# ==================== 配置区域 ====================
# 在这里修改您的数据路径
DATA_PATH = r"D:\your\data\path"  # 请修改为您的实际路径

# 在这里修改您的标签映射关系
original_labels = [
    "crack",           # 裂纹
    "scratch",         # 划痕
    "dent",            # 凹陷
    "rust",            # 锈蚀
    "stain",           # 污渍
    "burr",            # 毛刺
    "defect"           # 缺陷
]

new_labels = [
    "crack_new",       # 新裂纹标签
    "scratch_new",     # 新划痕标签
    "dent_new",        # 新凹陷标签
    "rust_new",        # 新锈蚀标签
    "stain_new",       # 新污渍标签
    "burr_new",        # 新毛刺标签
    "defect_new"       # 新缺陷标签
]

# 可选：指定要处理的特定文件夹
target_folders = None  # 例如：["A1", "B1", "C1"]
# ================================================
```

### 2. 运行脚本

- **方法1**: 双击 `change_labels_simple.py` 文件
- **方法2**: 在IDE中运行
- **方法3**: 命令行运行 `python change_labels_simple.py`

### 3. 确认操作

脚本运行后会显示：
- 配置的路径
- 标签映射关系
- 目标文件夹列表
- 确认提示

输入 `y` 或 `是` 继续执行，输入其他内容取消操作。

## 配置说明

### 数据路径 (DATA_PATH)

设置要搜索的根目录路径。脚本会在这个路径下递归搜索所有子文件夹。

**示例**:
```python
DATA_PATH = r"D:\数据集\缺陷检测"
DATA_PATH = r"C:\Users\用户名\Desktop\图片数据"
DATA_PATH = r"Y:\4_训练数据\2025-08-04领益 东莞  B747 Hinge AOI 改造C241104"
```

### 标签映射

`original_labels` 和 `new_labels` 必须一一对应：

```python
original_labels = ["标签1", "标签2", "标签3"]
new_labels = ["新标签1", "新标签2", "新标签3"]
```

**注意事项**:
- 两个数组的长度必须相同
- 标签按数组下标一一对应
- 只修改JSON文件中存在的标签

### 目标文件夹 (target_folders)

必须指定要处理的文件夹名称列表，脚本会在根路径下递归搜索这些文件夹。

**示例**:
```python
# 只处理A1文件夹
target_folders = ["A1"]

# 处理A1和B1文件夹
target_folders = ["A1", "B1"]

# 处理A1、B1、C1文件夹
target_folders = ["A1", "B1", "C1"]
```

**注意**: 脚本会深度搜索根路径下的所有子文件夹，找到所有匹配名称的文件夹。

## 工作流程

1. **读取配置**: 从代码中读取路径和标签配置
2. **深度搜索**: 递归搜索根路径下的所有子文件夹，找到指定的目标文件夹（A1、B1、C1等）
3. **遍历JSON文件**: 在每个找到的文件夹中查找所有JSON文件
4. **修改标签**: 根据映射关系修改JSON中的标签
5. **保存文件**: 将修改后的内容写回JSON文件
6. **统计结果**: 显示处理统计信息

## 输出示例

```
JSON标签修改工具 - 简化版
==================================================
数据路径: Y:\4_训练数据\2025-08-04领益 东莞  B747 Hinge AOI 改造C241104

标签映射关系:
  轮廓 -> 挂具印

目标文件夹名称: ['A1']

即将处理路径: Y:\4_训练数据\2025-08-04领益 东莞  B747 Hinge AOI 改造C241104
请确认路径和标签映射关系是否正确
是否继续？(y/n): y

开始深度搜索目标文件夹: ['A1']
找到目标文件夹: Y:\4_训练数据\2025-08-04领益 东莞  B747 Hinge AOI 改造C241104\项目A\子项目1\A1
找到目标文件夹: Y:\4_训练数据\2025-08-04领益 东莞  B747 Hinge AOI 改造C241104\其他文件夹\A1
搜索完成，共找到 2 个目标文件夹

==================================================
处理文件夹: A1 (路径: Y:\4_训练数据\2025-08-04领益 东莞  B747 Hinge AOI 改造C241104\项目A\子项目1\A1)
==================================================
开始处理文件夹: Y:\4_训练数据\2025-08-04领益 东莞  B747 Hinge AOI 改造C241104\项目A\子项目1\A1
找到 5 个JSON文件

处理文件: A1_001.json
  修改标签: 轮廓 -> 挂具印
成功修改 Y:\4_训练数据\2025-08-04领益 东莞  B747 Hinge AOI 改造C241104\项目A\子项目1\A1\A1_001.json，共修改 1 个标签

处理文件: A1_002.json
文件 A1_002.json 中没有需要修改的标签
...

==================================================
处理完成！总体统计:
==================================================
总文件夹数: 3
已处理文件夹数: 3

文件夹 A1:
  总文件数: 5
  已处理文件数: 5
  成功修改: 3
  失败: 0

文件夹 B1:
  总文件数: 3
  已处理文件数: 3
  成功修改: 2
  失败: 0

文件夹 C1:
  总文件数: 4
  已处理文件数: 4
  成功修改: 1
  失败: 0

处理完成！
按回车键退出...
```

## 注意事项

### 1. 数据安全
- **务必备份**: 在运行脚本前，请务必备份您的数据
- **确认配置**: 仔细检查路径和标签映射关系
- **试运行**: 建议先用少量数据测试

### 2. 文件格式
- 只处理JSON格式文件
- JSON文件必须包含 `shapes` 字段
- 标签信息在 `shapes[].label` 中

### 3. 权限要求
- 确保脚本有读取目标文件夹的权限
- 确保脚本有修改JSON文件的权限

### 4. 编码支持
- 脚本使用UTF-8编码处理文件
- 支持中文标签和路径

## 常见问题

### Q: 路径不存在怎么办？
A: 检查 `DATA_PATH` 变量是否正确，确保路径存在且可访问。

### Q: 标签数量不匹配怎么办？
A: 确保 `original_labels` 和 `new_labels` 数组长度相同。

### Q: 没有找到JSON文件？
A: 检查目标文件夹中是否包含JSON文件，确认文件扩展名为 `.json`。

### Q: 标签没有修改？
A: 检查JSON文件中的标签是否与 `original_labels` 中的标签匹配。

### Q: 如何只处理特定文件夹？
A: 设置 `target_folders` 变量，例如：`["A1", "B1"]`。

### Q: 脚本能找到嵌套很深的文件夹吗？
A: 是的，脚本会递归搜索所有子文件夹，无论嵌套多深都能找到。

### Q: 如果根路径下有多个同名文件夹怎么办？
A: 脚本会找到所有同名的文件夹并分别处理，每个文件夹的统计信息会单独显示。

## 系统要求

- **Python版本**: Python 3.6 或更高版本
- **依赖模块**: 仅使用Python标准库（os, json, pathlib, typing）
- **操作系统**: 支持Windows、Linux、macOS
- **内存要求**: 根据JSON文件大小而定，通常不需要大量内存

## 技术支持

如果遇到问题，请检查：
1. Python版本是否满足要求
2. 路径配置是否正确
3. 标签映射是否匹配
4. 文件权限是否足够
5. JSON文件格式是否正确

## 更新日志

- **v2.0**: 深度搜索版本
  - 递归搜索所有子文件夹
  - 支持任意深度的嵌套目录结构
  - 自动发现所有匹配名称的文件夹
  - 分别处理每个找到的文件夹

- **v1.0**: 初始版本，支持基本的标签修改功能
  - 批量处理JSON文件
  - 详细的统计信息
  - 交互式确认机制 